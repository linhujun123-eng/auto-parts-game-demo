<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>éƒ¨ä»¶å¯»å®å¤§å†’é™© Demo</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            overflow-x: hidden;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }
        
        .game-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }
        
        /* é¡¶éƒ¨çŠ¶æ€æ  */
        .status-bar {
            background: linear-gradient(to right, #4299e1, #3182ce);
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .player-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .gear-count {
            font-size: 24px;
            font-weight: bold;
            color: #f6ad55;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.2);
        }
        
        /* æ¸¸æˆä¸»åŒºåŸŸ */
        .game-area {
            padding: 20px;
            min-height: 500px;
            background: linear-gradient(180deg, #ebf8ff 0%, #e6fffa 100%);
        }
        
        .scene-title {
            text-align: center;
            color: #2d3748;
            margin-bottom: 20px;
            font-size: 28px;
        }
        
        .engine-scene {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }
        
        @media (max-width: 600px) {
            .engine-scene {
                grid-template-columns: 1fr;
            }
        }
        
        .engine-part {
            background: white;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            border: 3px solid transparent;
        }
        
        .engine-part:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
            border-color: #4299e1;
        }
        
        .engine-part.completed {
            border-color: #48bb78;
            background: #f0fff4;
        }
        
        .part-icon {
            font-size: 40px;
            margin-bottom: 10px;
        }
        
        .part-name {
            font-weight: bold;
            color: #2d3748;
            margin-bottom: 5px;
        }
        
        .part-desc {
            font-size: 12px;
            color: #718096;
        }
        
        /* ä»»åŠ¡åˆ—è¡¨ */
        .task-list {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }
        
        .task-item {
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 10px;
            border-left: 4px solid #cbd5e0;
            transition: all 0.3s ease;
        }
        
        .task-item.current {
            background: #ebf8ff;
            border-left-color: #4299e1;
        }
        
        .task-item.completed {
            background: #f0fff4;
            border-left-color: #48bb78;
        }
        
        /* äº¤äº’é¢æ¿ */
        .interaction-panel {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 100;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .interaction-panel.active {
            opacity: 1;
            visibility: visible;
        }
        
        .panel-content {
            background: white;
            border-radius: 20px;
            padding: 30px;
            width: 90%;
            max-width: 500px;
            text-align: center;
            transform: translateY(20px);
            transition: transform 0.3s ease;
        }
        
        .interaction-panel.active .panel-content {
            transform: translateY(0);
        }
        
        /* æ»‘åŠ¨è§£é”åŒºåŸŸ - ä¿®å¤ç‰ˆ */
        .swipe-container {
            width: 100%;
            height: 80px;
            background: #e2e8f0;
            border-radius: 40px;
            margin: 25px 0;
            position: relative;
            overflow: hidden;
            user-select: none;
        }
        
        .swipe-track {
            position: relative;
            width: 100%;
            height: 100%;
        }
        
        .swipe-handle {
            position: absolute;
            left: 10px;
            top: 10px;
            width: 60px;
            height: 60px;
            background: #4299e1;
            border-radius: 30px;
            cursor: grab;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            z-index: 2;
            transition: left 0.1s ease;
            touch-action: none;
        }
        
        .swipe-progress {
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            background: linear-gradient(90deg, #48bb78, #38a169);
            width: 0;
            border-radius: 40px;
            transition: width 0.1s ease;
        }
        
        .swipe-text {
            position: absolute;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #718096;
            font-size: 16px;
            font-weight: bold;
            z-index: 1;
            pointer-events: none;
        }
        
        .swipe-success {
            position: absolute;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #48bb78;
            font-size: 24px;
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
        }
        
        .swipe-success.show {
            opacity: 1;
        }
        
        .knowledge-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
        }
        
        /* æŒ‰é’® */
        .btn {
            background: #4299e1;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 5px;
            min-height: 44px; /* ç§»åŠ¨ç«¯å‹å¥½ */
        }
        
        .btn:hover {
            background: #3182ce;
            transform: translateY(-2px);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .btn-success {
            background: #48bb78;
        }
        
        .btn-success:hover {
            background: #38a169;
        }
        
        /* åŠ¨ç”» */
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        .floating {
            animation: float 2s ease-in-out infinite;
        }
        
        @keyframes celebrate {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }
        
        .celebrate {
            animation: celebrate 0.5s ease-in-out;
        }
        
        @keyframes confetti {
            0% { transform: translateY(0) rotate(0deg); opacity: 1; }
            100% { transform: translateY(500px) rotate(360deg); opacity: 0; }
        }
        
        .confetti {
            position: fixed;
            font-size: 20px;
            z-index: 1000;
            animation: confetti 2s linear forwards;
            pointer-events: none;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <!-- é¡¶éƒ¨çŠ¶æ€æ  -->
        <div class="status-bar">
            <div class="player-info">
                <div>ğŸ‘¦ å°å°æœºæ¢°å¸ˆ</div>
                <div class="gear-count">çŸ¥è¯†é½¿è½®: <span id="gearCount">0</span></div>
            </div>
            <div>ç¬¬ä¸€å…³ï¼šå¼•æ“åŸå ¡</div>
        </div>
        
        <!-- æ¸¸æˆä¸»åŒºåŸŸ -->
        <div class="game-area">
            <h2 class="scene-title">ğŸš— å¼•æ“åŸå ¡å¤§å†’é™©</h2>
            
            <!-- ä»»åŠ¡åˆ—è¡¨ -->
            <div class="task-list">
                <h3>ğŸ“‹ å½“å‰ä»»åŠ¡</h3>
                <div id="taskList">
                    <!-- ä»»åŠ¡ä¼šåŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>
            
            <!-- å¼•æ“åœºæ™¯ -->
            <div class="engine-scene" id="engineScene">
                <!-- éƒ¨ä»¶ä¼šåŠ¨æ€ç”Ÿæˆ -->
            </div>
            
            <!-- å®Œæˆæç¤º -->
            <div id="completionMessage" style="text-align: center; display: none;">
                <div class="knowledge-card">
                    <h3>ğŸ‰ æ­å–œï¼ç¬¬ä¸€å…³å®Œæˆï¼</h3>
                    <p>ä½ æˆåŠŸä¿®å¤äº†å¼•æ“åŸå ¡ï¼Œè·å¾—äº† <span id="finalGears">0</span> ä¸ªçŸ¥è¯†é½¿è½®ï¼</p>
                    <button class="btn btn-success" onclick="restartGame()">å†ç©ä¸€æ¬¡</button>
                </div>
            </div>
            
            <div style="text-align: center; margin-top: 30px; color: #718096; font-size: 14px;">
                <p>ğŸ’¡ æç¤ºï¼šç‚¹å‡»ä¸åŒçš„æ±½è½¦éƒ¨ä»¶å¼€å§‹å­¦ä¹ å§ï¼</p>
            </div>
        </div>
    </div>
    
    <!-- äº¤äº’é¢æ¿ -->
    <div class="interaction-panel" id="interactionPanel">
        <div class="panel-content" id="panelContent">
            <!-- å†…å®¹ä¼šåŠ¨æ€ç”Ÿæˆ -->
        </div>
    </div>
    
    <script>
        // æ¸¸æˆæ•°æ®
        const gameData = {
            gears: 0,
            currentTask: 0,
            tasks: [
                {
                    id: 'hood',
                    name: 'æ‰“å¼€å¼•æ“ç›–',
                    description: 'æ»‘åŠ¨è§£é”å¼•æ“ç›–',
                    completed: false,
                    type: 'swipe',
                    icon: 'ğŸšª',
                    partName: 'å¼•æ“ç›–',
                    pinyin: 'yÇn qÃ­ng gÃ i',
                    function: 'ä¿æŠ¤å‘åŠ¨æœºèˆ±çš„"å®‰å…¨é—¨"ï¼Œé˜²æ­¢ç°å°˜å’Œæ°´è¿›å…¥',
                    funFact: 'æœ€æ—©çš„æ±½è½¦æ²¡æœ‰å¼•æ“ç›–ï¼Œå‘åŠ¨æœºå®Œå…¨æš´éœ²åœ¨å¤–ï¼'
                },
                {
                    id: 'battery',
                    name: 'æ‰¾åˆ°ç”µæ± ',
                    description: 'ç‚¹å‡»å‘ç°æ±½è½¦ç”µæ± ',
                    completed: false,
                    type: 'click',
                    icon: 'ğŸ”‹',
                    partName: 'ç”µæ± ',
                    pinyin: 'diÃ n chÃ­',
                    function: 'æ±½è½¦çš„"èƒ½é‡å¿ƒè„"ï¼Œä¸ºæ‰€æœ‰ç”µå­è®¾å¤‡ä¾›ç”µ',
                    funFact: 'æ±½è½¦ç”µæ± ç”µå‹æ˜¯12Vï¼Œæ¯”ç©å…·ç”µæ± çš„1.5Vå¼º8å€ï¼'
                },
                {
                    id: 'air_filter',
                    name: 'æ¸…æ´ç©ºæ°”æ»¤æ¸…å™¨',
                    description: 'æ‹–æ‹½æ¸…æ´å·¥å…·',
                    completed: false,
                    type: 'drag',
                    icon: 'ğŸŒ€',
                    partName: 'ç©ºæ°”æ»¤æ¸…å™¨',
                    pinyin: 'kÅng qÃ¬ lÇœ qÄ«ng qÃ¬',
                    function: 'å‘åŠ¨æœºçš„"å£ç½©"ï¼Œè¿‡æ»¤ç©ºæ°”ä¸­çš„ç°å°˜',
                    funFact: 'å¦‚æœä¸æ¸…æ´ï¼Œæ»¤æ¸…å™¨å¯èƒ½ä¼šè¢«ç°å°˜å®Œå…¨å µä½ï¼'
                },
                {
                    id: 'radiator',
                    name: 'ç»™æ°´ç®±åŠ æ°´',
                    description: 'ç‚¹å‡»æ°´å£¶ç»™æ°´ç®±åŠ æ°´',
                    completed: false,
                    type: 'pour',
                    icon: 'ğŸ’§',
                    partName: 'æ°´ç®±',
                    pinyin: 'shuÇ xiÄng',
                    function: 'å‘åŠ¨æœºçš„"ç©ºè°ƒ"ï¼Œé˜²æ­¢è¿‡çƒ­',
                    funFact: 'æ°´ç®±é‡Œçš„æ°´ä¸æ˜¯æ™®é€šæ°´ï¼Œæ˜¯ç‰¹æ®Šçš„å†·å´æ¶²ï¼'
                },
                {
                    id: 'engine',
                    name: 'å¯åŠ¨å¼•æ“',
                    description: 'æŒ‰æ­£ç¡®é¡ºåºå¯åŠ¨',
                    completed: false,
                    type: 'sequence',
                    icon: 'âš™ï¸',
                    partName: 'å‘åŠ¨æœº',
                    pinyin: 'fÄ dÃ²ng jÄ«',
                    function: 'æ±½è½¦çš„"å¿ƒè„"ï¼ŒæŠŠç‡ƒæ–™å˜æˆåŠ¨åŠ›',
                    funFact: 'å‘åŠ¨æœºæ¯åˆ†é’Ÿå¯ä»¥è½¬åŠ¨å‡ åƒæ¬¡ï¼'
                }
            ]
        };

        // åˆå§‹åŒ–æ¸¸æˆ
        function initGame() {
            updateTaskList();
            createEngineScene();
            updateGearDisplay();
        }

        // æ›´æ–°ä»»åŠ¡åˆ—è¡¨æ˜¾ç¤º
        function updateTaskList() {
            const taskList = document.getElementById('taskList');
            taskList.innerHTML = '';
            
            gameData.tasks.forEach((task, index) => {
                const taskDiv = document.createElement('div');
                taskDiv.className = `task-item ${index === gameData.currentTask ? 'current' : ''} ${task.completed ? 'completed' : ''}`;
                taskDiv.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <span style="color: ${task.completed ? '#48bb78' : '#718096'}">
                            ${task.completed ? 'âœ…' : `${index + 1}.`}
                        </span>
                        <span style="font-weight: ${index === gameData.currentTask ? 'bold' : 'normal'}">
                            ${task.name}
                        </span>
                    </div>
                    ${!task.completed && index === gameData.currentTask ? 
                        `<div style="font-size: 12px; color: #718096; margin-top: 5px;">
                            ${task.description}
                        </div>` : ''
                    }
                `;
                taskList.appendChild(taskDiv);
            });
        }

        // åˆ›å»ºå¼•æ“åœºæ™¯
        function createEngineScene() {
            const engineScene = document.getElementById('engineScene');
            engineScene.innerHTML = '';
            
            gameData.tasks.forEach((task, index) => {
                const partDiv = document.createElement('div');
                partDiv.className = `engine-part ${task.completed ? 'completed' : ''}`;
                partDiv.innerHTML = `
                    <div class="part-icon">${task.icon}</div>
                    <div class="part-name">${task.partName}</div>
                    <div class="part-desc">${task.completed ? 'å·²å®Œæˆ' : 'ç‚¹å‡»å­¦ä¹ '}</div>
                `;
                
                partDiv.onclick = () => {
                    if (index === gameData.currentTask) {
                        startInteraction(task);
                    } else if (index < gameData.currentTask) {
                        showKnowledgeCard(task);
                    }
                };
                
                // ç§»åŠ¨ç«¯è§¦æ‘¸äº‹ä»¶æ”¯æŒ
                partDiv.addEventListener('touchstart', (e) => {
                    e.preventDefault();
                    if (index === gameData.currentTask) {
                        startInteraction(task);
                    } else if (index < gameData.currentTask) {
                        showKnowledgeCard(task);
                    }
                }, { passive: false });
                
                engineScene.appendChild(partDiv);
            });
        }

        // å¼€å§‹äº¤äº’
        function startInteraction(task) {
            const panel = document.getElementById('interactionPanel');
            const content = document.getElementById('panelContent');
            
            panel.classList.add('active');
            
            if (task.type === 'swipe') {
                content.innerHTML = `
                    <h2>æ»‘åŠ¨è§£é”å¼•æ“ç›–</h2>
                    <p>å‘å³æ»‘åŠ¨æŠŠæ‰‹æ¥æ‰“å¼€å¼•æ“ç›–</p>
                    
                    <div class="swipe-container">
                        <div class="swipe-track">
                            <div class="swipe-progress" id="swipeProgress"></div>
                            <div class="swipe-handle" id="swipeHandle">â†’</div>
                            <div class="swipe-text" id="swipeText">å‘å³æ»‘åŠ¨è§£é”</div>
                            <div class="swipe-success" id="swipeSuccess">âœ… è§£é”æˆåŠŸï¼</div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 15px; font-size: 14px; color: #718096;">
                        æ»‘åŠ¨åˆ°æœ€å³è¾¹å³å¯è§£é”
                    </div>
                    
                    <div style="margin-top: 20px;">
                        <button class="btn" onclick="closePanel()">å–æ¶ˆ</button>
                        <button class="btn btn-success" onclick="completeTask('${task.id}')">è·³è¿‡ï¼ˆæµ‹è¯•ç”¨ï¼‰</button>
                    </div>
                `;
                
                setTimeout(() => {
                    setupSwipeInteraction(task);
                }, 50);
            } else if (task.type === 'click') {
                content.innerHTML = `
                    <h2>æ‰¾åˆ°ç”µæ± </h2>
                    <p>ç‚¹å‡»ä¸‹é¢çš„ç”µæ± æ¥å‘ç°å®ƒ</p>
                    
                    <div style="font-size: 60px; margin: 30px 0; cursor: pointer;" 
                         onclick="completeTask('${task.id}')" 
                         ontouchstart="completeTask('${task.id}')"
                         class="floating">
                        ğŸ”‹
                    </div>
                    
                    <p>ç”µæ± åœ¨å“ªé‡Œï¼Ÿé€šå¸¸åœ¨å¼•æ“èˆ±çš„è§’è½</p>
                    <button class="btn" onclick="closePanel()">å–æ¶ˆ</button>
                `;
            } else if (task.type === 'drag') {
                content.innerHTML = `
                    <h2>æ¸…æ´ç©ºæ°”æ»¤æ¸…å™¨</h2>
                    <p>æ‹–æ‹½æ¸…æ´å·¥å…·æ¥æ¸…æ´æ»¤æ¸…å™¨</p>
                    
                    <div style="position: relative; height: 200px; margin: 20px 0;">
                        <div style="position: absolute; left: 50px; top: 50px; font-size: 40px;">
                            ğŸŒ€
                        </div>
                        <div id="cleanTool" 
                             style="position: absolute; left: 300px; top: 50px; font-size: 40px; cursor: grab;"
                             ontouchstart="startDrag(event)"
                             ontouchmove="dragTool(event)"
                             ontouchend="checkCleaning(event)">
                            ğŸ§¹
                        </div>
                    </div>
                    
                    <p>æŠŠæ¸…æ´å·¥å…·æ‹–åˆ°æ»¤æ¸…å™¨ä¸Š</p>
                    <button class="btn" onclick="completeTask('${task.id}')">æˆ‘å·²ç»æ¸…æ´äº†</button>
                    <button class="btn" onclick="closePanel()">å–æ¶ˆ</button>
                `;
                
                setTimeout(() => {
                    setupDragInteraction();
                }, 100);
            } else {
                content.innerHTML = `
                    <h2>å­¦ä¹ ï¼š${task.partName}</h2>
                    <p>ç‚¹å‡»æŒ‰é’®å®Œæˆè¿™ä¸ªä»»åŠ¡</p>
                    <button class="btn" onclick="completeTask('${task.id}')">æˆ‘çŸ¥é“äº†ï¼</button>
                    <button class="btn" onclick="closePanel()">å–æ¶ˆ</button>
                `;
            }
        }

        // è®¾ç½®æ»‘åŠ¨äº¤äº’ - ä¿®å¤ç‰ˆï¼ˆæ”¯æŒç§»åŠ¨ç«¯ï¼‰
        function setupSwipeInteraction(task) {
            const handle = document.getElementById('swipeHandle');
            const progress = document.getElementById('swipeProgress');
            const swipeText = document.getElementById('swipeText');
            const swipeSuccess = document.getElementById('swipeSuccess');
            
            let isDragging = false;
            let startX = 0;
            let currentX = 0;
            const container = document.querySelector('.swipe-container');
            const maxDrag = container.offsetWidth - handle.offsetWidth - 20; // å‡å»è¾¹è·
            
            // é¼ æ ‡äº‹ä»¶
            handle.addEventListener('mousedown', startDrag);
            document.addEventListener('mousemove', drag);
            document.addEventListener('mouseup', endDrag);
            
            // è§¦æ‘¸äº‹ä»¶ï¼ˆç§»åŠ¨ç«¯ï¼‰
            handle.addEventListener('touchstart', startDragTouch, { passive: false });
            document.addEventListener('touchmove', dragTouch, { passive: false });
            document.addEventListener('touchend', endDrag);
            
            function startDrag(e) {
                isDragging = true;
                startX = e.clientX;
                handle.style.cursor = 'grabbing';
                e.preventDefault();
            }
            
            function startDragTouch(e) {
                if (e.touches.length === 1) {
                    isDragging = true;
                    startX = e.touches[0].clientX;
                    e.preventDefault();
                }
            }
            
            function drag(e) {
                if (!isDragging) return;
                
                currentX = e.clientX - startX;
                updateSwipePosition();
                e.preventDefault();
            }
            
            function dragTouch(e) {
                if (!isDragging || e.touches.length !== 1) return;
                
                currentX = e.touches[0].clientX - startX;
                updateSwipePosition();
                e.preventDefault();
            }
            
            function updateSwipePosition() {
                // é™åˆ¶æ»‘åŠ¨èŒƒå›´
                currentX = Math.max(0, Math.min(maxDrag, currentX));
                
                // æ›´æ–°æ‰‹æŸ„ä½ç½®
                handle.style.left = `${currentX + 10}px`;
                
                // æ›´æ–°è¿›åº¦æ¡
                const progressPercent = (currentX / maxDrag) * 100;
                progress.style.width = `${progressPercent}%`;
                
                // æ£€æŸ¥æ˜¯å¦å®Œæˆ
                if (progressPercent >= 95) {
                    swipeSuccess.classList.add('show');
                    swipeText.style.opacity = '0';
                    
                    // å®Œæˆä»»åŠ¡
                    setTimeout(() => {
                        completeTask(task.id);
                    }, 500);
                }
            }
            
            function endDrag() {
                if (!isDragging) return;
                
                isDragging = false;
                handle.style.cursor = 'grab';
                
                // å¦‚æœæ²¡å®Œæˆï¼Œå¼¹å›åŸä½
                const progressPercent = (currentX / maxDrag) * 100;
                if (progressPercent < 95) {
                    handle.style.left = '10px';
                    progress.style.width = '0';
                    currentX = 0;
                    swipeSuccess.classList.remove('show');
                    swipeText.style.opacity = '1';
                }
            }
            
            // æ·»åŠ ç‚¹å‡»æ»‘åŠ¨åŒºåŸŸä¹Ÿå¯ä»¥æ‹–åŠ¨çš„æ”¯æŒ
            container.addEventListener('mousedown', (e) => {
                if (e.target === container) {
                    startX = e.clientX;
                    currentX = 0;
                    isDragging = true;
                    updateSwipePosition();
                }
            });
            
            container.addEventListener('touchstart', (e) => {
                if (e.touches.length === 1 && e.target === container) {
                    startX = e.touches[0].clientX;
                    currentX = 0;
                    isDragging = true;
                    updateSwipePosition();
                    e.preventDefault();
                }
            }, { passive: false });
        }

        // ç§»åŠ¨ç«¯æ‹–æ‹½æ”¯æŒ
        let isDraggingTool = false;
        let dragStartX = 0;
        let dragStartY = 0;
        let toolElement = null;
        
        function startDrag(e) {
            isDraggingTool = true;
            toolElement = document.getElementById('cleanTool');
            
            if (e.type === 'touchstart') {
                dragStartX = e.touches[0].clientX - parseInt(toolElement.style.left);
                dragStartY = e.touches[0].clientY - parseInt(toolElement.style.top);
            } else {
                dragStartX = e.clientX - parseInt(toolElement.style.left);
                dragStartY = e.clientY - parseInt(toolElement.style.top);
            }
            
            toolElement.style.cursor = 'grabbing';
            toolElement.textContent = 'ğŸ§½';
            e.preventDefault();
        }
        
        function dragTool(e) {
            if (!isDraggingTool || !toolElement) return;
            
            let clientX, clientY;
            if (e.type === 'touchmove') {
                clientX = e.touches[0].clientX;
                clientY = e.touches[0].clientY;
            } else {
                clientX = e.clientX;
                clientY = e.clientY;
            }
            
            const panelContent = document.querySelector('.panel-content');
            const rect = panelContent.getBoundingClientRect();
            
            // é™åˆ¶åœ¨é¢æ¿å†…ç§»åŠ¨
            const x = Math.max(0, Math.min(clientX - dragStartX - rect.left, rect.width - 40));
            const y = Math.max(0, Math.min(clientY - dragStartY - rect.top, rect.height - 40));
            
            toolElement.style.left = `${x}px`;
            toolElement.style.top = `${y}px`;
            
            e.preventDefault();
        }
        
        function checkCleaning(e) {
            if (!isDraggingTool || !toolElement) return;
            
            isDraggingTool = false;
            toolElement.style.cursor = 'grab';
            
            // æ£€æŸ¥æ˜¯å¦åœ¨æ»¤æ¸…å™¨é™„è¿‘ï¼ˆ50pxå†…ï¼‰
            const toolX = parseInt(toolElement.style.left);
            const toolY = parseInt(toolElement.style.top);
            
            if (toolX < 100 && toolY < 100) { // æ»¤æ¸…å™¨åœ¨å·¦ä¸Šè§’
                toolElement.textContent = 'âœ¨';
                setTimeout(() => {
                    completeTask('air_filter');
                }, 300);
            } else {
                toolElement.textContent = 'ğŸ§¹';
            }
        }

        // å®Œæˆä»»åŠ¡
        function completeTask(taskId) {
            const taskIndex = gameData.tasks.findIndex(t => t.id === taskId);
            
            if (taskIndex >= 0 && !gameData.tasks[taskIndex].completed) {
                // æ ‡è®°ä»»åŠ¡å®Œæˆ
                gameData.tasks[taskIndex].completed = true;
                
                // å¥–åŠ±é½¿è½®
                gameData.gears += 1;
                
                // æ›´æ–°å½“å‰ä»»åŠ¡
                if (taskIndex === gameData.currentTask) {
                    gameData.currentTask++;
                    
                    // æ˜¾ç¤ºçŸ¥è¯†å¡ç‰‡
                    setTimeout(() => {
                        showKnowledgeCard(gameData.tasks[taskIndex]);
                    }, 300);
                }
                
                // æ›´æ–°æ˜¾ç¤º
                updateTaskList();
                createEngineScene();
                updateGearDisplay();
                
                // æ’­æ”¾åº†ç¥æ•ˆæœ
                celebrateCompletion();
                
                // æ£€æŸ¥æ˜¯å¦å®Œæˆæ‰€æœ‰ä»»åŠ¡
                if (gameData.tasks.every(t => t.completed)) {
                    setTimeout(() => {
                        showCompletionMessage();
                    }, 1000);
                }
                
                // å…³é—­é¢æ¿
                setTimeout(() => {
                    closePanel();
                }, 800);
            }
        }

        // æ˜¾ç¤ºçŸ¥è¯†å¡ç‰‡
        function showKnowledgeCard(task) {
            const panel = document.getElementById('interactionPanel');
            const content = document.getElementById('panelContent');
            
            panel.classList.add('active');
            content.innerHTML = `
                <div class="knowledge-card">
                    <h2 style="margin-bottom: 10px;">âœ¨ æ–°çŸ¥è¯†è§£é”ï¼</h2>
                    <div style="font-size: 40px; margin: 10px 0;">${task.icon}</div>
                    <h3>${task.partName} <small style="opacity: 0.8;">${task.pinyin}</small></h3>
                    <p style="margin: 10px 0;">${task.function}</p>
                    <div style="background: rgba(255, 255, 255, 0.2); padding: 10px; border-radius: 10px; margin: 15px 0;">
                        <strong>ğŸ’¡ è¶£å‘³çŸ¥è¯†</strong>
                        <p style="margin-top: 5px;">${task.funFact}</p>
                    </div>
                    <button class="btn" onclick="closePanel()">å¤ªæ£’äº†ï¼ç»§ç»­å­¦ä¹ </button>
                </div>
            `;
        }

        // æ˜¾ç¤ºå®Œæˆæ¶ˆæ¯
        function showCompletionMessage() {
            document.getElementById('finalGears').textContent = gameData.gears;
            document.getElementById('completionMessage').style.display = 'block';
            
            // åº†ç¥æ•ˆæœ
            createConfettiEffect();
        }

        // åº†ç¥æ•ˆæœ
        function celebrateCompletion() {
            // é½¿è½®è®¡æ•°åŠ¨ç”»
            const gearCount = document.getElementById('gearCount');
            gearCount.classList.add('celebrate');
            setTimeout(() => {
                gearCount.classList.remove('celebrate');
            }, 500);
        }

        // åˆ›å»ºå½©èŠ±æ•ˆæœ
        function createConfettiEffect() {
            const emojis = ['ğŸ‰', 'âœ¨', 'ğŸŠ', 'â­', 'âš™ï¸', 'ğŸš—', 'ğŸ”§', 'ğŸ”‹'];
            
            for (let i = 0; i < 15; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.textContent = emojis[Math.floor(Math.random() * emojis.length)];
                    confetti.style.left = `${Math.random() * 100}%`;
                    confetti.style.color = ['#4299e1', '#48bb78', '#f6ad55', '#ed64a6'][Math.floor(Math.random() * 4)];
                    
                    // éšæœºåŠ¨ç”»å‚æ•°
                    const duration = 1 + Math.random() * 2;
                    const delay = Math.random() * 0.5;
                    confetti.style.animationDuration = `${duration}s`;
                    confetti.style.animationDelay = `${delay}s`;
                    
                    document.body.appendChild(confetti);
                    
                    // åŠ¨ç”»ç»“æŸåç§»é™¤
                    setTimeout(() => {
                        if (confetti.parentNode) {
                            confetti.remove();
                        }
                    }, (duration + delay) * 1000);
                }, i * 100);
            }
        }

        // å…³é—­é¢æ¿
        function closePanel() {
            document.getElementById('interactionPanel').classList.remove('active');
        }

        // æ›´æ–°é½¿è½®æ˜¾ç¤º
        function updateGearDisplay() {
            document.getElementById('gearCount').textContent = gameData.gears;
        }

        // é‡æ–°å¼€å§‹æ¸¸æˆ
        function restartGame() {
            gameData.gears = 0;
            gameData.currentTask = 0;
            gameData.tasks.forEach(task => {
                task.completed = false;
            });
            
            document.getElementById('completionMessage').style.display = 'none';
            closePanel();
            initGame();
        }

        // é˜²æ­¢ç§»åŠ¨ç«¯é¡µé¢æ»šåŠ¨
        document.addEventListener('touchmove', function(e) {
            if (document.getElementById('interactionPanel').classList.contains('active')) {
                e.preventDefault();
            }
        }, { passive: false });

        // åˆå§‹åŒ–æ¸¸æˆ
        initGame();
        
        // æ§åˆ¶å°æç¤º
        console.log('ğŸš— éƒ¨ä»¶å¯»å®å¤§å†’é™© Demo å·²åŠ è½½ï¼');
        console.log('ğŸ’¡ æç¤ºï¼šæ»‘åŠ¨è§£é”æ—¶è¯·å°†æ‰‹æŸ„æ‹–åˆ°æœ€å³è¾¹');
    </script>
</body>
</html>
